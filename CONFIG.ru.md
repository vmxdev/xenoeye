# Полное описание конфигурационных файлов

    * [Главный файл конфигурации `xenoeye.conf`]()
    * [Установка частоты семплирования `devices.conf`]()
    * [Описание объекта мониторинга `mo.conf`]()

## Общая информация

Конфигурация состоит из двух общих конфигурационных файлов и нескольких файлов, которые описывают объекты мониторинга.

Конфигурационные файлы в `xenoeye` — это JSON, в котором разрешены комментарии.

Допускаются два типа комментариев: однострочные, начинаются с `//` и продолжаются до конца строки и многострочные, начинаются с `/*` и заканчиваются `*/`

При чтении конфигов неизвестные ключи игнорируются

### Главный файл конфигурации `xenoeye.conf`

Файл состоит из таких секций

```
{
	"capture": [
		{"socket": {"listen-on": "*", "port": "2055"}},
		{"pcap" : {"interface": "eth0", "filter": "udp and port 2055"}}
	],

	"templates": {
		"db": "/var/lib/xenoeye/templates.tkvdb"
	},

	"debug": {
		/* allowed values: "none", "syslog", "/path/to/file.txt" */
		"dump-flows": "none"
	},

	"devices": "/etc/xenoeye/devices.conf",

	"mo-dir": "/var/lib/xenoeye/mo"
}
```

#### Секция `capture`

Каждый элемент из массива описывает поток обработки netflow.

Коллектор может захватывать netflow-пакеты двумя способами: обычным интерфейсом сокетов и с помощью pcap

`socket` — обычный интерфейс сокетов. Параметры - адрес на котором слушать и порт

`pcap` — захват пакетов с помощью библиотеки libpcap. Параметры - название интерфейса, на котором захватывать netflow и BPF-фильтр.

BPF-фильтр может быть пустым, тогда коллектор будет пытаться парсить все UDP-пакеты на этом интерфейсе.

Рабочий поток захватывает только те пакеты, которые матчатся фильтром.


#### Секция `templates`

В этой секции можно указать файл, в котором хранятся netflow-шаблоны. Шаблоны хранятся на диске, после старта коллектор читает их и может сразу декодировать фловы.

Для того, чтобы различать устройства, используется комбинацию IP адреса источника netflow (роутера) плюс ID источника.

#### Секция `debug`

Коллектор может печатать для отладки содержимое декодированных фловов. В зависимости от значения `"dump-flows"` он может печатать в syslog + stderr или в файл.

Если выбрана печать в syslog, сообщения дополнительно выводятся в stderr (`LOG_PERROR`). Facility = `LOG_USER`, level = `LOG_DEBUG`.

При печати в файл используется буферизация, данные появляются в файле не сразу, а через время и блоками

#### Ключи `devices` и `mo-dir`

Указывают на файл с частотой семплирования и каталогом с объектами мониторинга (см. ниже)


### Установка частоты семплирования `devices.conf`

Коллектор (по крайней мере сейчас) не читает данные о частоте семплирования из option template. Для установки частоты нужно записать ее в файл `devices.conf`. Формат файла такой:

```
[
	{
		"ip": "127.0.0.1",
		"id": 0,
		"sampling-rate": 1
	},
	{
		"ip": "1.2.3.4",
		"sampling-rate": 1000
	}
	/* ... */
]
```

### Описание объекта мониторинга `mo.conf`

Допускается пустой фильтр:
```
"filter": ""
```

В этом случае в объект мониторинга попадут все фловы
