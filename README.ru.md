# xenoeye
Netflow collector and analyzer

[![Build Status](https://app.travis-ci.com/vmxdev/xenoeye.svg?branch=master)](https://app.travis-ci.com/vmxdev/xenoeye)

Программа находится в стадии планирования и разработки, используйте с осторожностью

Сейчас коллектор может захватывать Netflow, парсить фловы, фильтровать по заданным правилам, агрегировать данные по разным netflow-полям и экспортировать в СУБД для дальнейшего анализа и визуализации.


###Поддерживаемые протоколы:

  * Netflow v9
  * IPFIX


###Поддерживаемые netflow-поля можно посмотреть в файле netflow.def.


Фильтры задаются BPF-подобными правилами. Например, фильтр "src net 1.2.3.4/28 and proto 17" выберет только фловы с UDP-трафиком, идущим из сети 1.2.3.4/28.
Текущий набор полей, по которым работает фильтрация, можно посмотреть в файле filter.def.


Если вы хотите добавить новое netflow-поле или поле фильтрации, смотрите ниже (TBW)


Коллектор может генерировать текстовые файлы для экспорта в СУБД. На данный момент поддерживается только PostgreSQL.


Визуализировать данные из СУБД можно с помощью Grafana.



###Сборка

Для минимальной установки Debian нужно доустановить такие пакеты:

```sh
$ sudo apt -y install git autoconf gcc make libpcap-dev
```

Клонируем репозиторий и инициализируем подмодули

```sh
$ git clone https://github.com/vmxdev/xenoeye
$ cd xenoeye
$ git submodule update --init --recursive
```

Собственно сборка

```sh
$ autoreconf -i
$ /configure --sysconfdir=/etc/xenoeye --localstatedir=/var/lib
$ make
```

После этого мы должны получить бинарный файл xenoeye

Опциональный шаг:

```sh
$ sudo make install
```

make install копирует бинарный файл xenoeye в /usr/local/bin, конфигурационные файлы xenoeye.conf и devices.conf в /etc/xenoeye и создает каталоги /var/lib/xenoeye/mo, /var/lib/xenoeye/exp и /var/lib/xenoeye/expfailed.

Каталог /var/lib/xenoeye должен быть доступен для записи процессу xenoeye

Все пути по умолчанию можно изменить, они задаются в конфигурационном файле xenoeye.conf. Конфигурационный файл - это JSON, в котором разрешены комментарии.


###Настраиваем и тестируем получение netflow

xenoeye может принимать netflow двумя способами - обычным интерфейсом сокетов или с помощью pcap.

Второй способ больше подходит для тестов. Если у вас, например, есть .pcap-файлы с netflow-трафиком, вы можете проиграть их на loopback интерфейсе с помощью tcpreplay (tcpreplay -i lo dump.pcap) и отправить в коллектор.

За захват netflow отвечает секция "capture". Там перечислены сокеты, на которых коллектор будет слушать и pcap-интерфейсы c BPF-фильтрами.

Чтобы увидеть, что коллектор принимает и декодирует фловы, выставьте параметр "dump-flows" в секции "debug". Допускаются значения

  * "none" - фловы не логгируются
  * "syslog" - декодированные фловы передаются в syslog и дополнительно печатаются в stderr
  * "/path/to/file.txt" - фловы пишутся в файл

Запускаем коллектор
```sh
$ xenoeye
```

или 

```sh
$ xenoeye -c /path/to/xenoeye.conf
```

Если вы используете захват с помощью pcap, коллектор должен запускаться с правами суперпользователя

