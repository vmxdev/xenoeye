<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>XE web-view 1.0</title>

    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='bootstrap.min.css') }}" rel="stylesheet">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="{{ url_for('static', filename='dashboard.css') }}" rel="stylesheet">
  </head>
  <body>
    
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="">XE</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <!--  <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search"> -->
  <div class="col-md-3 col-lg-2 me-0 px-3">
    <p class="text-light">{{ g.user['displayname'] }}:
    {{ g.user['description'] }}</p>
  </div>
  <div class="navbar-nav">
    <div class="nav-item text-nowrap">
      <a class="nav-link px-3" href="logout">Sign out</a>
    </div>
  </div>
</header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">

    {% for nav in g.nav %}
      {% set outer_loop = loop %}
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>{{ nav.section }}</span>
          <a class="link-secondary" href="#" aria-label="reports">
          </a>
        </h6>
        <ul class="nav flex-column mb-2">
          {% for r in nav.r %}
          <li class="nav-item active">
            <a class="nav-link" href="?mo={{ g.curr_mo.mo_name }}&s={{ outer_loop.index0 }}&r={{ loop.index0 }}">
              {{ r.name }}
            </a>
          </li>
          {% endfor %}
        </ul>
    {% endfor %}

      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">

  <label for="exampleDataList" class="form-label">Monitoring object</label>
  <input class="form-control" list="datalistOptions" id="exampleDataList" placeholder="Type to search...">

  <datalist id="datalistOptions">
    {% for mo in g.mo %}
    <option value="{{ mo.mo_name }}">{{ mo.mo_display }}</option>
    {% endfor %}
  </datalist>

</div>

      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">{{ g.r.name }}</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
            6 hours
          </button>
        </div>
      </div>

{% for ch in g.r.charts %}
      <div class="d-flex align-items-center justify-content-center" id="gd{{ loop.index0 }}-load">
        <!--<strong>Loading...</strong>-->
        <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
      </div>
      <div id="gd{{ loop.index0 }}"></div>
{% endfor %}
<!--
      <h2>Anomalies</h2>
      <div class="table-responsive">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Active</th>
              <th scope="col">Start time</th>
              <th scope="col">End time</th>
              <th scope="col">Type</th>
              <th scope="col">Monitoring object</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1,001</td>
              <td>random</td>
              <td>data</td>
              <td>placeholder</td>
              <td>text</td>
              <td>text</td>
            </tr>
            <tr>
              <td>1,002</td>
              <td>placeholder</td>
              <td>irrelevant</td>
              <td>visual</td>
              <td>layout</td>
              <td>layout</td>
            </tr>
          </tbody>
        </table>
      </div>
-->
    </main>
  </div>
</div>

    <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='plotly.min.js') }}"></script>
    <script>
{% for ch in g.r.charts %}
{% if ch["type"] == "ttl" %}
fetch('/lk/r.data?mo={{ g.curr_mo.mo_name }}&s={{ g.curr_section }}&r={{ g.curr_rep }}&c={{ loop.index0 }}')
  .then((response) => response.json())
  .then((data) => {
		var time = data.map( ([ t, pkts, octs ]) => (new Date(t * 1000)) );
		var pkts = data.map( ([ t, pkts, octs ]) => (pkts) );
		var octs = data.map( ([ t, pkts, octs ]) => (octs * 8) );

		var pps = {
			x: time,
			y: pkts,
			name: 'PPS',
			type: 'bar'
		};
		var bps = {
			x: time,
			y: octs,
			yaxis: 'y2',
			name: 'BPS',
			type: 'bar'
		};

		var data = [pps, bps];

		var layout = {
			title: {text: '{{ ch.name }}'},
			showlegend: true,
			legend: {"orientation": "h"},
			yaxis: {
				title: {
					text: 'PPS'
				}
			},
			yaxis2: {
				title: {
					text: 'BPS',
					font: {color: 'rgb(148, 103, 189)'}
				},
				tickfont: {color: 'rgb(148, 103, 189)'},
				overlaying: 'y',
				side: 'right'
			}
		};

		Plotly.newPlot('gd{{ loop.index0 }}', data, layout);
		let spinner = document.getElementById("gd{{ loop.index0 }}-load");
		spinner.style.visibility = 'hidden';
  })
  .catch(console.error);
{% endif %}
{% if ch["type"] == "v" %}
fetch('/lk/r.data?mo={{ g.curr_mo.mo_name }}&s={{ g.curr_section }}&r={{ g.curr_rep }}&c={{ loop.index0 }}')
  .then((response) => response.json())
  .then((data) => {
		var time = data.map( ([ t, pkts, octs, proto ]) => (new Date(t * 1000)) );
		var proto = data.map( ([ t, pkts, octs, proto ]) => (proto) );
		var uniq_proto = Array.from(new Set(data.map( ([ t, pkts, octs, proto ]) => (proto) )));

		var plot_data = [];
		uniq_proto.forEach((item) => {
			var prot_v = data.map(([ t, pkts, octs, proto ]) => {
				if (proto === item) {
					return pkts;
				} else {
					return 0;
				}
			});

			var bps = {
				x: time,
				y: prot_v,
				name: '{{ ch["cap"] }} ' + item,
				type: 'bar'
			};
			plot_data.push(bps);
		});

		var layout = {
			title: {text: '{{ ch["name"] }}'},
			showlegend: true,
			legend: {"orientation": "h"},
			barmode: 'stack',
			yaxis: {
				title: {
					text: 'PPS'
				}
			}
		};

		Plotly.newPlot('gd{{ loop.index0 }}', plot_data, layout);
		let spinner = document.getElementById("gd{{ loop.index0 }}-load");
		spinner.style.visibility = 'hidden';
  })
  .catch(console.error);
{% endif %}
{% if ch["type"] == "tbl" %}
fetch('/lk/r.data?mo={{ g.curr_mo.mo_name }}&s={{ g.curr_section }}&r={{ g.curr_rep }}&c={{ loop.index0 }}')
  .then((response) => response.json())
  .then((data) => {
		var time = data.map( ([ t, pkts, octs, proto ]) => (new Date(t * 1000)) );
		var proto = data.map( ([ t, pkts, octs, proto ]) => (proto) );
		var uniq_proto = Array.from(new Set(data.map( ([ t, pkts, octs, proto ]) => (proto) )));


		let spinner = document.getElementById("gd{{ loop.index0 }}-load");
		spinner.style.visibility = 'hidden';
  })
  .catch((err) => {
		let doc = document.getElementById("gd{{ loop.index0 }}");
		doc.innerHTML = "<h5>{{ ch["name"] }}</h5><div>No data</div>";
		let spinner = document.getElementById("gd{{ loop.index0 }}-load");
		spinner.style.visibility = 'hidden';
});
{% endif %}
{% endfor %}
    </script>

  </body>
</html>
